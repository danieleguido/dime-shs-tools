/*
 * Copyright (c) 2011 Joseph Cava-Lynch
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
(function(a){a.ScrollToFixed=function(c,f){var i=this;i.$el=a(c);i.el=c;i.$el.data("ScrollToFixed",i);var b=false;var x=i.$el;var v=0;var l=0;var g=-1;var d=-1;var n=null;var s;function o(){h();d=-1;v=x.offset().top;l=x.offset().left;if(g==-1){orginalOffsetLeft=l}b=true;if(i.options.bottom!=-1){q()}}function k(){return x.css("position")=="fixed"}function r(){return x.css("position")=="absolute"}function e(){return !(k()||r())}function q(){if(!k()){n.css({display:x.css("display"),width:x.outerWidth(true),height:x.outerHeight(true),"float":x.css("float")});x.css({width:x.width(),position:"fixed",top:i.options.bottom==-1?m():"",bottom:i.options.bottom==-1?"":i.options.bottom})}}function h(){if(!e()){d=-1;n.css("display","none");x.css({width:"",position:"",left:"",top:""})}}function p(y){if(y!=d){x.css("left",l-y);d=y}}function m(){return i.options.marginTop}function t(){if(!b){o()}var z=a(window).scrollLeft();var A=a(window).scrollTop();if(i.options.bottom==-1){if(i.options.limit>0&&A>=i.options.limit-m()){if(!r()){j();x.trigger("preAbsolute");x.css({width:x.width(),position:"absolute",top:i.options.limit,left:l});x.trigger("unfixed")}}else{if(A>=v-m()){if(!k()){j();x.trigger("preFixed");q();d=-1;x.trigger("fixed")}p(z)}else{if(k()){j();x.trigger("preUnfixed");h();x.trigger("unfixed")}}}}else{if(i.options.limit>0){if(A+a(window).height()-x.outerHeight(true)>=i.options.limit-m()){if(k()){j();x.trigger("preUnfixed");h();x.trigger("unfixed")}}else{if(!k()){j();x.trigger("preFixed");q()}p(z);x.trigger("fixed")}}else{p(z)}}}function j(){var y=x.css("position");if(y=="absolute"){x.trigger("postAbsolute")}else{if(y=="fixed"){x.trigger("postFixed")}else{x.trigger("postUnfixed")}}}var u=function(y){o();t()};var w=function(y){t()};i.init=function(){i.options=a.extend({},a.ScrollToFixed.defaultOptions,f);if(navigator.platform==="iPad"||navigator.platform==="iPhone"||navigator.platform==="iPod"){if(!navigator.userAgent.match(/OS 5_.*\ like Mac OS X/i)){return}}i.$el.css("z-index",i.options.zIndex);n=a("<div />");i.$el.after(n);a(window).bind("resize.ScrollToFixed",u);a(window).bind("scroll.ScrollToFixed",w);if(i.options.preFixed){x.bind("preFixed.ScrollToFixed",i.options.preFixed)}if(i.options.postFixed){x.bind("postFixed.ScrollToFixed",i.options.postFixed)}if(i.options.preUnfixed){x.bind("preUnfixed.ScrollToFixed",i.options.preUnfixed)}if(i.options.postUnfixed){x.bind("postUnfixed.ScrollToFixed",i.options.postUnfixed)}if(i.options.preAbsolute){x.bind("preAbsolute.ScrollToFixed",i.options.preAbsolute)}if(i.options.postAbsolute){x.bind("postAbsolute.ScrollToFixed",i.options.postAbsolute)}if(i.options.fixed){x.bind("fixed.ScrollToFixed",i.options.fixed)}if(i.options.unfixed){x.bind("unfixed.ScrollToFixed",i.options.unfixed)}if(i.options.spacerClass){n.addClass(i.options.spacerClass)}x.bind("scroll.ScrollToFixed",function(){h();t()});x.bind("remove.ScrollToFixed",function(){h();a(window).unbind("resize",u);a(window).unbind("scroll",w);x.unbind(".ScrollToFixed")});if(i.options.bottom!=-1){if(!k()){j();x.trigger("preFixed.ScrollToFixed");q()}}};i.init()};a.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1000};a.fn.scrollToFixed=function(b){return this.each(function(){(new a.ScrollToFixed(this,b))})}})(jQuery);